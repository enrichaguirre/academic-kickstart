---
title: Zonas Economicas de Mar de Plata
author: Lucas Enrich
date: '2019-12-20'
slug: zonas-economicas-de-mar-de-plata
categories:
  - urbana
tags: []
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## ANÁLISIS Y EVOLUCIÓN DE LA OFERTA DE INMUEBLES 


Entender el mercado inmobiliario, nos permite detectar las necesidades y deseos de la porción de la población que compran, o que invierten en la generación de servicios de vivienda (ya sea para consumo propio o para terceros).

El mercado inmobiliario, está compuesto por un conjunto de bienes y servicios heterogéneos, no sólo en sus características, sino también en su localización.

Estas características de cada uno de los inmuebles que se encuentran en el mercado constituyen, en su conjunto, las características de la oferta de inmuebles en un determinado período de tiempo. 
Habitualmente, lo que se observa del mercado inmobiliario es un stock de la oferta y se asume que el precio es el de equilibrio, en el sentido que los oferentes intentarían obtener el mayor precio que le posibilite la venta o el alquiler, en el menor tiempo posible. Sin embargo, el flujo de inmuebles que se han vendido no es un conjunto observable y tal vez sea el conjunto más importante por determinar.
Este flujo que se ha vendido o alquilado representa a aquellos inmuebles que hoy no se encuentran en el stock disponible a la venta o en alquiler, pero que en algún momento lo estuvieron; por lo que es necesario conformar una base de datos con los inmuebles que están disponibles actualmente en stock, pero también aquellos que en un lapso han salido y aquellos nuevos que ingresan a conformarlo.
Para ello se desarrolló una rutina a través de un software, que permite relevar los datos de compra y venta de inmuebles disponibles en la web, para analizar su evolución en el tiempo, para poder construir distintos indicadores que sirvan como herramientas para los desarrolladores inmobiliarios, a la hora de decidir las características y el emplazamiento de sus proyectos.

## Estudio de la base 


```{r echo = FALSE, message = FALSE, warning = FALSE}
library(knitr)
source('pre-proc.R')
mardel_oct = read_csv('./mardel informe/octubre_mardel.csv')
mardel_nov = read_csv('./mardel informe/mardel_limpio.csv')
mardel_dec = read_csv('./mardel informe/mardel_dec_limpio.csv')

mardel = rbind(mardel_oct, mardel_nov %>% select(colnames(mardel_oct)),mardel_dec %>% select(colnames(mardel_oct))) %>% distinct(id, .keep_all = T)


mardel_summary = function(mardel){
  mardel %>% group_by(Tipo) %>% 
    summarise(
      Cantidad = n(),
      Precio_M2 = mean(p.x.m2, na.rm = T) %>% round(),
      Tamaño = mean(Metros, na.rm = T)%>% round(),
      Precio = mean(Prices, na.rm = T)%>% round()
      
      ) %>% arrange(-Cantidad) %>% head(10)
  
  
}


mardeltalbe1 = mardel_summary(mardel)
```

El total de registro de ventas con los que contamos en para el tercer trimestre de 2019 de nuestra búsqueda de datos en la web, una vez que se han eliminado los datos repetidos, es de aproximadamente `r nrow(mardel)` casos, de los cuales, `r mardeltalbe1$Cantidad[mardeltalbe1$Tipo == 'Departamento']` corresponden a departamentos y `r mardeltalbe1$Cantidad[mardeltalbe1$Tipo == 'Casa']` corresponden a casas. En el cuadro resumen de la base de ventas se tuvieron en cuenta algunas características como la cantidad de m2 ofertados, m2 promedio y valor en dólares promedio para Mar del Plata.


```{r echo = FALSE, message = FALSE, warning = FALSE}
kable(mardeltalbe1, caption = "Caracteristicas de la Base de Ventas")

top1prop = round((mardeltalbe1$Cantidad[1]/sum(mardeltalbe1$Cantidad))*100,2)
top2prop = round((mardeltalbe1$Cantidad[2]/sum(mardeltalbe1$Cantidad))*100,2)
topprop = top1prop+top2prop


```



De la tabla, se desprende que el `r topprop`% de oferta inmobiliaria de Mar del Plata esta compuesta por `r mardeltalbe1$Tipo[1]` (`r top1prop`%) y `r mardeltalbe1$Tipo[2]` (`r top2prop`%) y que los departamentos tienen el mayor precio por metro cuadrado, por el menor tamaño de las ofertas.







Asimismo, los datos del trimestre revelan la variación de las cantidades, los precios y tamaños de cada tipo de inmueble.

```{r echo = FALSE, message = FALSE, warning = FALSE}
library(scales)

library(ggpubr)

library(lubridate)
summ_oct = mardel_summary(mardel_oct)
summ_nov = mardel_summary(mardel_nov)
summ_dec = mardel_summary(mardel_dec)
summ_dec['Mes'] = ymd("2019-12-01")
summ_nov['Mes'] = ymd("2019-11-01")
summ_oct['Mes'] = ymd("2019-10-01")
summ_all = rbind(summ_oct,summ_nov,summ_dec)



p1<-summ_all %>% filter(Cantidad>500) %>% ggplot(aes(x = Mes, y = Tamaño))+
  geom_line(aes(color = Tipo, group = Tipo),size = 1)+labs(title="Tamaño del Inmueble")+
  geom_point(aes(color = Tipo))+theme_bw()+ theme(legend.position = "none")+
  scale_x_date(date_breaks = "1 month",labels = date_format("%b"))+ theme(plot.title = element_text(size=10))



p2<-summ_all %>% filter(Cantidad>500) %>% ggplot(aes(x = Mes, y = Precio))+
  geom_line(aes(color = Tipo, group = Tipo),size = 1)+labs(title="Precio del Inmueble")+
  geom_point(aes(color = Tipo))+theme_bw()+ theme(legend.position = "bottom")+
  scale_x_date(date_breaks = "1 month",labels = date_format("%b"))+ theme(plot.title = element_text(size=10))




p3<-summ_all %>% filter(Cantidad>500) %>% ggplot(aes(x = Mes, y = Precio_M2))+
  geom_line(aes(color = Tipo, group = Tipo),size = 1)+labs(title="Precio por M² del Inmueble")+
  geom_point(aes(color = Tipo))+theme_bw()+scale_x_date(date_breaks = "1 month",labels = date_format("%b"))+ theme(legend.position = "none")+ theme(plot.title = element_text(size=10))



ggarrange(p1, p2, p3, ncol=3, nrow=1, common.legend = TRUE, legend="bottom")

```


En este caso, podemos ver, por ejemplo, que el aumento del tamaño promedio de los inmuebles, causa que, a pesar de un aumento del precio, el precio por metro cuadrado tenga una ligera caida. Lo contrario ocurre con los PHs. Lo cual en el caso de los terrenos (una mejora metodologica en Octubre nos permite obtener mejores datos de Terrenos y Locales Comerciales), las variaciones se compensan y se mantiene estabe el precio por metro cuadrado



La infomación obtenida esta geolocalizada en un 97%, lo cual nos permite ubicar en un mapa los inmuebles a la venta, y poder visualizar la densidad de la oferta de inmuebles. La mayor densida, de acuerdo a los datos, se encuentra en los barrios de La Perla, donde una hay una desproporcionada densidad de inmuebles. 

En el norte, cerca de Parque Peña, hay un foco de oferta; al sur, este foco está en Los Acantilados 

Por lo general, estos focos de oferta se encuentran en la costa (salvo Los Acantilados). Aquellos que se encuentran fuera, se caracterizan por ser los barrios cerrados Rumencó y Arenas del Sur


```{r echo = FALSE, message = FALSE, warning = FALSE}
library(leaflet)
library("KernSmooth")
library("raster")
library(data.table)
#trimestr =rbind(mardel_oct, mardel_nov %>% select(colnames(mardel_oct)),mardel_dec %>% #select(colnames(mardel_oct))) %>% distinct(id, .keep_all = T)

plot_mardel = function(mardel){
  library(leaflet)
  library("KernSmooth")
  library("raster")
  library(data.table)
  mardelat = mean(mardel$Latitud, na.rm = T)
  mardelong = mean(mardel$Longitud, na.rm = T)
  colnames(mardel)[colnames(mardel)=='Latitud']  = 'latitude'
  colnames(mardel)[colnames(mardel)=='Longitud']  = 'longitude'
  
  
  dat <- data.table(mardel)
  setnames(dat, tolower(colnames(dat)))
  setnames(dat, gsub(" ", "_", colnames(dat)))
  dat <- dat[!is.na(longitude)]
  ## Create kernel density output
  kde <- bkde2D(dat[, list(longitude, latitude)],
                bandwidth = c(.0045, .0068),
                gridsize = c(2500, 2500))
  KernelDensityRaster <-
    raster(list(
      x = kde$x1 ,
      y = kde$x2 ,
      z = kde$fhat
    ))
  KernelDensityRaster@data@values[which(KernelDensityRaster@data@values < 1)] <-
    NA
  kernel_density_values <- KernelDensityRaster@data@values
  KernelDensityRaster@data@values=log(KernelDensityRaster@data@values,10)
  
  #create pal function for coloring the raster
  palRaster <-colorNumeric("Spectral",domain = KernelDensityRaster@data@values,na.color = "transparent")
  
  ## Redraw the map 
  #palRaster <- colorBin("Spectral",domain = KernelDensityRaster@data@values, na.color = "transparent")
  palRaster1 <- colorBin("Spectral",domain = 10^KernelDensityRaster@data@values, na.color = "transparent")
  
  leaflet() %>% setView(lng = mean(mardel$longitude,na.rm = T), lat = mean(mardel$latitude,na.rm = T), zoom = 10)%>% addTiles() %>%
    addLegend(pal = palRaster1,
              values = 10^KernelDensityRaster@data@values,
              title = "Densidad de Oferta Inmobiliaria") %>% 
    addRasterImage(KernelDensityRaster,
                   colors = palRaster,
                   opacity = .65)
    
}

## Redraw the map
if(knitr::is_html_output()) {
  plot_mardel(mardel)
} else {
  library("png")
  pp <- readPNG("mapamardel.png")
  plot.new()
  rasterImage(pp, 0, 0, 1, 1)
}

```

La base de datos cuenta también con inmuebles que han reducido su precio en los últimos 6 meses.

```{r echo = FALSE, message = FALSE, warning = FALSE}
bajaron_table = read_csv('./mardel informe/bajaron_table.csv')
#kable(bajaron_table, caption = "Bajaron de Precio")
source('informe_data.R')

```
```{r echo = FALSE, message = FALSE, warning = FALSE}
pie_inmobiliaria
```
De lo cual se desprende varias cosas, en primer lugar, que son los departamentos son las princiales únidades que registran bajas de precios, seguidos por los PH. En segundo lugar, que aquellos Departamentos que bajaron tienen un precio y tamaño menor al promedio, en cuanto a los PH, tienen un precio por metro cuadrado mayor al promedio, pero también, son más chicos y tienen un precio más chico, esto se explica porque la variacion del tamaño es mayor a la variacion del precio.  
